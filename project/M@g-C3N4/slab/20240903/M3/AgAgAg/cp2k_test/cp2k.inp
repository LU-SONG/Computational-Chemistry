#Generated by Multiwfn
@SET DATAPATH /opt/cp2k-8.2/data
&GLOBAL
  PROJECT input
  PRINT_LEVEL LOW
  RUN_TYPE GEO_OPT
&END GLOBAL

&FORCE_EVAL
  METHOD Quickstep
  &SUBSYS
    &TOPOLOGY
      COORD_FILE_FORMAT xyz
      COORD_FILE_NAME  ./cp2k.xyz
    &END TOPOLOGY
    &CELL
     A    22.2683999999999997    0.0000000000000000    0.0000000000000000
     B   -11.6518632578163466   19.8660777110417399    0.0000000000000000
     C     0.0000000000000000    0.0000000000000000   20.0000000000000000
     PERIODIC XY   #Direction of applied PBC (geometry aspect)
     #MULTIPLE_UNIT_CELL ${NREP} ${NREP} ${NREP}
    &END CELL
    &KIND H
      ELEMENT H
      BASIS_SET TZVP-MOLOPT-GTH-q1
      POTENTIAL GTH-PBE
    &END KIND
    &KIND C
      ELEMENT C
      BASIS_SET TZVP-MOLOPT-GTH-q4
      POTENTIAL GTH-PBE
    &END KIND
    &KIND N
      ELEMENT N
      BASIS_SET TZVP-MOLOPT-GTH-q5
      POTENTIAL GTH-PBE
    &END KIND
    &KIND O
      ELEMENT O
      BASIS_SET TZVP-MOLOPT-GTH-q6
      POTENTIAL GTH-PBE
    &END KIND
    &KIND Fe
      ELEMENT Fe
      BASIS_SET TZVP-MOLOPT-SR-GTH-q16
      POTENTIAL GTH-PBE
    &END KIND
  &END SUBSYS

  &DFT
    BASIS_SET_FILE_NAME  ${DATAPATH}/BASIS_MOLOPT
    BASIS_SET_FILE_NAME  ${DATAPATH}/BASIS_MOLOPT_UCL   
    POTENTIAL_FILE_NAME  ${DATAPATH}/POTENTIAL
    WFN_RESTART_FILE_NAME cp2k-RESTART.wfn
    UKS T
    CHARGE    0 #Net charge
    #MULTIPLICITY    1 #Spin multiplicity
    #ADDED_MOS 500
    #CHOLESKY  INVERSE
    #SURFACE_DIPOLE_CORRECTION T
    #SURF_DIP_DIR Z
    
    &QS
      EPS_DEFAULT 1E-14 #This is default. Set all EPS_xxx to values such that the energy will be correct up to this value
      EXTRAPOLATION ASPC
      EXTRAPOLATION_ORDER 3
    &END QS
    &XC
      &XC_FUNCTIONAL PBE
      &END XC_FUNCTIONAL
      #      &VDW_POTENTIAL
      #   POTENTIAL_TYPE PAIR_POTENTIAL
      #   &PAIR_POTENTIAL
      #      PARAMETER_FILE_NAME dftd3.dat
      #      TYPE DFTD3(BJ)
      #      REFERENCE_FUNCTIONAL PBE
      #   &END PAIR_POTENTIAL
      # &END VDW_POTENTIAL
    &END XC
    &MGRID
      CUTOFF 400
      REL_CUTOFF 55
    &END MGRID
    &SCF
      MAX_SCF 40
      EPS_SCF 1.0E-06 #Convergence threshold of density matrix during SCF
      SCF_GUESS ATOMIC #Use wavefunction from WFN_RESTART_FILE_NAME file as initial guess
      &OT T
         MINIMIZER CG
         LINESEARCH 3PNT
         PRECONDITIONER FULL_KINETIC
      &END OT
      &OUTER_SCF T
         EPS_SCF 1.0E-06
         MAX_SCF 30
      &END OUTER_SCF
      #&DIAGONALIZATION
      #  ALGORITHM STANDARD #Algorithm for diagonalization. DAVIDSON is faster for large systems
      #&END DIAGONALIZATION
      #&MIXING #How to mix old and new density matrices
      #  METHOD BROYDEN_MIXING #PULAY_MIXING is also a good alternative
      #  ALPHA 0.4 #Default. Mixing 40% of new density matrix with the old one
      #  BETA  1.5
      #  NBROYDEN 8 #Default is 4. Number of previous steps stored for the actual mixing scheme
      #&END MIXING
      #&SMEAR
      #  METHOD FERMI_DIRAC
      #  ELECTRONIC_TEMPERATURE 300 #Electronic temperature of Fermi-Dirac smearing in K
      #&END SMEAR

      #&PRINT
      #  &RESTART #Use "&RESTART OFF" can prevent generating wfn file
      #     FILENAME=RESTART.wfn
      #     BACKUP_COPIES 0 #Maximum number of backup copies of wfn file
      #  &END RESTART
      #&END PRINT
    &END SCF
  &END DFT
  &PRINT 
    &FORCES ON
    &END FORCES
  &END PRINT
&END FORCE_EVAL

&MOTION
  &GEO_OPT
    MAX_ITER 200
    OPTIMIZER LBFGS
    MAX_FORCE 1.0E-3
  &END GEO_OPT
# ------------- Constraints --------------- #
  &CONSTRAINT
  &END CONSTRAINT
  &PRINT
    &TRAJECTORY
      FORMAT xyz
      &EACH
        GEO_OPT 1
      &END EACH
    &END TRAJECTORY
    &RESTART
      BACKUP_COPIES 0 #Maximum number of backing up restart file, 0 means never
    &END RESTART
  &END PRINT
&END MOTION
